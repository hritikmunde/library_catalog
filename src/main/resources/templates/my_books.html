<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>My Books</title>
  <link rel="stylesheet" href="/css/header.css">
  <style>
    body{font-family:system-ui,Arial,sans-serif;background:#f9fafb;margin:0}
    .wrap{max-width:900px;margin:2rem auto;background:#fff;border-radius:12px;box-shadow:0 2px 6px rgba(0,0,0,.06);padding:1.5rem}
    h1{margin:0 0 1rem}
    table{width:100%;border-collapse:collapse}
    th,td{padding:.7rem;border-bottom:1px solid #e5e7eb;text-align:left}
    .muted{color:#6b7280}
    .btn{background:#2563eb;color:#fff;padding:.4rem .7rem;border-radius:.4rem;text-decoration:none;border:0;cursor:pointer}
    .btn-outline{background:#fff;color:#2563eb;border:1px solid #2563eb}
    .btn-danger{background:#ef4444}
    .grid{display:grid;grid-template-columns:1fr;gap:1.25rem}
    .section h2{margin:.5rem 0}
    form{display:inline}
  </style>
</head>
<body>
<header th:replace="fragments/topbar :: topbar"></header>

<main class="wrap">
  <h1>Your books</h1>

  <section class="section">
    <h2>Currently Rented</h2>
    <table th:if="${#lists.isEmpty(rentals) == false}">
      <thead><tr><th>Title</th><th>Due</th><th class="muted">Extensions</th><th>Actions</th></tr></thead>
      <tbody>
      <tr th:each="b : ${rentals}">
        <td><a th:href="@{/books/{id}(id=${b.id})}" th:text="${b.title}">Title</a></td>
        <td>
          <span th:if="${b.dueDate != null}" th:text="${#temporals.format(b.dueDate, 'MMM d, yyyy')}"></span>
          <span th:if="${b.dueDate == null}" class="muted">â€”</span>
        </td>
        <td class="muted">[[${b.extensions}]] / [[${maxExtensions}]]</td>
        <td>
          <!-- Return -->
          <form th:action="@{/books/{id}/return(id=${b.id})}" method="post">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
            <button type="submit" class="btn btn-danger">Return</button>
          </form>

          <!-- Extend -->
          <form th:if="${b.extensions < maxExtensions}"
                th:action="@{/books/{id}/extend(id=${b.id})}" method="post">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
            <button type="submit" class="btn btn-outline">
              Extend +[[${@environment.getProperty('app.loan-days','14')}]]d
            </button>
          </form>
          <button th:if="${b.extensions >= maxExtensions}" class="btn btn-outline" disabled>Extend (maxed)</button>
        </td>
      </tr>
      </tbody>
    </table>
    <p th:if="${#lists.isEmpty(rentals)}" class="muted">You have no current rentals.</p>
  </section>

  <section class="section" style="margin-top:1.25rem">
    <h2>Waitlist</h2>
    <table th:if="${#lists.isEmpty(requests) == false}">
      <thead><tr><th>Title</th><th>Your position</th><th>Actions</th></tr></thead>
      <tbody>
      <tr th:each="req : ${requests}">
        <td><a th:href="@{/books/{id}(id=${req.book.id})}" th:text="${req.book.title}">Title</a></td>
        <td># [[${req.position}]]</td>
        <td>
          <form th:action="@{/books/{id}/unrequest(id=${req.book.id})}" method="post">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
            <button type="submit" class="btn btn-outline">Remove</button>
          </form>
        </td>
      </tr>
      </tbody>
    </table>
    <p th:if="${#lists.isEmpty(requests)}" class="muted">You aren't on any waitlists.</p>
  </section>
</main>
</body>
</html>
